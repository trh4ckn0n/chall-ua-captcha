<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Web Challenge</title>
</head>
<body>
    <h1>Challenge avancé pour développeurs</h1>
    <p>Pour gagner, vous devez résoudre un challenge JavaScript.</p>
    <button id="executePayload">Exécuter le Payload</button>

    <form action="/verify" method="POST">
        <div class="g-recaptcha" data-sitekey="6LcRMhYrAAAAAD3Q25z4bOZ8q4mh6SsQMuW20cKI"></div>
        <button type="submit">Soumettre</button>
    </form>

    <script>
        document.getElementById('executePayload').onclick = function() {
            // Payload JS avancé
            const secretKey = 'trhacknonflag';
            const challengeSteps = [
                function() { return prompt('Entrez le mot de passe : '); },
                function() { return confirm('Êtes-vous sûr ?'); },
                function() { return Math.random() > 0.5; } // Déclenche une condition aléatoire
            ];

            let stepIndex = 0;

            function executeStep() {
                if (stepIndex < challengeSteps.length) {
                    if (!challengeSteps[stepIndex]()) {
                        alert('Échec de l\'étape ' + (stepIndex + 1));
                        return;
                    }
                    stepIndex++;
                    executeStep();
                } else {
                    if (prompt('Veuillez entrer le mot de passe final : ') === secretKey) {
                        alert('Bravo ! Vous avez réussi le challenge.');
                        document.location.href = '/reward';  // Redirection vers la récompense
                    } else {
                        alert('Mot de passe incorrect. Réessayez.');
                    }
                }
            }

            executeStep();
        };
    </script>

    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
</body>
</html>
